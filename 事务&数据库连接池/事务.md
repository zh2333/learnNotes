# 事务&数据库连接池&DBUtils
## 事务
> Transaction,其实指的是一组操作,里面包含许多个单一的逻辑,只要有一个逻辑没有执行 成功,那么都算是失败,所有的数据都回归到最初的状态(回滚)

* 为什么要有事务?
>为了确保逻辑的成功.例子: 银行的转账.在事务中的一些操作在事务未提交之前只存在于内存中,没有固化到硬盘上,因此一旦数据操作出现问题,可以对事务进行回滚操作
.

### 使用命令行方式操作事务
start transaction代表一个事务的开始,commit代表一个事务的结束

### 使用java代码的方式操作事务
java中建立的数据库连接默认都是autocommit的,因此要在建立连接后将autocommit关闭
```java
//关闭autocommit
conn.setAutoCommit(false);
//开始事务
conn.startTransaction();
//出现异常回滚
conn.rollback();
```
>事务是面向连接的,不同连接中的事务互不干扰


### ACID特性
* 原子性
>事务中包含的额逻辑不可分割
* 一致性
> 事务执行前后数据的完整性保持一致
* 隔离性
> 事务在执行期间不应该受到其他事务的影响
* 持久性
> 事务执行成功,那么数据应该持久保存到磁盘中

### 事务的安全隐患
* 读
> 脏读  不可重复读  幻读
  * 脏读
  一个事务读取到了别的事务还未提交的数据.原因:隔离级别--->读未提交
  * 不可重复读
  .两次查询的结果不一样结果不一致.隔离级别:--->读已提交
  * 幻读
  一个事务读到了另一个事务已提交的插入的数据,导致多次查询
* 写
> 丢失更新
* 悲观锁---在查询时加上for update 
* 乐观锁---程序员自己写代码控制

* 隔离级别.隔离级别最低
  1. 读未提交
  2. 读已提交
  3. 可重复读
  4. 串行化.隔离级别最高,但是效率低